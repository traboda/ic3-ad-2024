import r2pipe
import sys

r = r2pipe.open("./bin{}".format(sys.argv[1]),flags = ['-w'])
r.cmd('aaaa')

#Patch for Overflow
r.cmd('s sym.createBasket')
r.cmd('so 7')
offset = int(r.cmd('pd 1').split()[5],16)
addr = int(r.cmd('pd 1').split()[1],16)
r.cmd('wa mov esi, {}'.format(hex(offset-0x10)) + ' @{}'.format(hex(addr)))

#Patch for Format String
r.cmd('s sym.viewBasket')
r.cmd('so 58')
addr = int(r.cmd('pd 1').split()[1],16)
r.cmd('wa call sym.imp.puts' + ' @{}'.format(hex(addr)))

#Patch for UAF
r.cmd('s sym.removeFruit')
r.cmd('so 73')
addr = int(r.cmd('pd 1').split()[-4],16)
location = int(r.cmd('pd 1').split()[-1],16)
r.cmd('wa jbe {}'.format(hex(location)) + ' @{}'.format(hex(addr)))
